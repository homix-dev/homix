# NATS Server Configuration for Home Automation (Hybrid Mode)
# This configuration supports both local users and Synadia Cloud credentials

# Server name and listen port
server_name: "home-automation-local"
port: 4222

# HTTP monitoring
http_port: 8222

# Define operator (from Synadia)
operator: $SYS

# System account resolver
resolver: {
  type: full
  dir: "/data/resolver"
}

# Authorization for local connections
authorization {
  # Define a user for local home automation services
  users = [
    {
      user: "home"
      password: "changeme"
      permissions: {
        publish: {
          allow: ["home.>", "_INBOX.>", "$JS.>"]
        }
        subscribe: {
          allow: ["home.>", "_INBOX.>", "$JS.>"]
        }
      }
    },
    {
      user: "admin"
      password: "admin-changeme"
      permissions: {
        publish: ">"
        subscribe: ">"
      }
    }
  ]
}

# JetStream configuration
jetstream {
  # Enable JetStream
  enabled: true
  
  # Directory for JetStream storage
  store_dir: "/data/jetstream"
  
  # Memory and file storage limits
  max_memory_store: 256MB
  max_file_store: 1GB
}

# Leaf node configuration to connect to Synadia Cloud
leafnodes {
  remotes = [
    {
      # URL from your Synadia Cloud cluster
      url: "tls://connect.ngs.global"
      
      # Path to your credentials file
      credentials: "/etc/nats/nats-home-automation.creds"
    }
  ]
}

# Logging configuration
debug: false
trace: false
logtime: true
log_file: "/data/nats-server.log"

# Limits
max_connections: 1024
max_control_line: 4096
max_payload: 1MB
max_pending: 64MB

# Ping intervals
ping_interval: "2m"
ping_max: 2

# Write deadline
write_deadline: "10s"